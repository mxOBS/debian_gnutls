From 1c59226bb239aa563d02b6ea8ed285de006e3b31 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ludovic=20Court=C3=A8s?= <ludo@gnu.org>
Date: Fri, 20 Jan 2012 22:55:44 +0100
Subject: [PATCH] guile: Update the list of error codes.

---
 guile/modules/gnutls.in              |   57 +++++++++++++++++++++++++++-----
 guile/modules/gnutls/build/enums.scm |   60 ++++++++++++++++++++++++++++------
 2 files changed, 98 insertions(+), 19 deletions(-)

diff --git a/guile/modules/gnutls.in b/guile/modules/gnutls.in
index 4ed4c06..383a9ba 100644
--- a/guile/modules/gnutls.in
+++ b/guile/modules/gnutls.in
@@ -258,10 +258,10 @@
            certificate-verify/allow-sign-rsa-md2
            certificate-verify/allow-sign-rsa-md5
 
+           ;; FIXME: Automate this:
+           ;; grep '^#define GNUTLS_E_' ../../lib/includes/gnutls/gnutls.h.in | \
+           ;;   sed -r -e 's|^#define GNUTLS_E_([^ ]+).*$|error/\1|' | tr A-Z_ a-z-
            error/success
-           error/unknown-compression-algorithm
-           error/unknown-cipher-type
-           error/large-packet
            error/unsupported-version-packet
            error/unexpected-packet-length
            error/invalid-session
@@ -270,9 +270,6 @@
            error/warning-alert-received
            error/error-in-finished-packet
            error/unexpected-handshake-packet
-           error/unknown-cipher-suite
-           error/unwanted-algorithm
-           error/mpi-scan-failed
            error/decryption-failed
            error/memory-error
            error/decompression-failed
@@ -287,7 +284,6 @@
            error/insuficient-cred
            error/hash-failed
            error/base64-decoding-error
-           error/mpi-print-failed
            error/rehandshake
            error/got-application-data
            error/record-limit-reached
@@ -312,8 +308,8 @@
            error/file-error
            error/too-many-empty-packets
            error/unknown-pk-algorithm
+           error/too-many-handshake-packets
            error/no-temporary-rsa-params
-           error/lzo-init-failed
            error/no-compression-algorithms
            error/no-cipher-suites
            error/openpgp-getkey-failed
@@ -340,7 +336,6 @@
            error/x509-unknown-san
            error/openpgp-fingerprint-unsupported
            error/x509-unsupported-attribute
-           error/unknown-algorithm
            error/unknown-hash-algorithm
            error/unknown-pkcs-content-type
            error/unknown-pkcs-bag-type
@@ -350,6 +345,12 @@
            error/warning-ia-iphf-received
            error/warning-ia-fphf-received
            error/ia-verify-failed
+           error/unknown-algorithm
+           error/unsupported-signature-algorithm
+           error/safe-renegotiation-failed
+           error/unsafe-renegotiation-denied
+           error/unknown-srp-username
+           error/premature-termination
            error/base64-encoding-error
            error/incompatible-gcrypt-library
            error/incompatible-crypto-library
@@ -357,7 +358,45 @@
            error/openpgp-keyring-error
            error/x509-unsupported-oid
            error/random-failed
+           error/base64-unexpected-header-error
+           error/openpgp-subkey-error
+           error/crypto-already-registered
+           error/handshake-too-large
+           error/cryptodev-ioctl-error
+           error/cryptodev-device-error
+           error/channel-binding-not-available
+           error/bad-cookie
+           error/openpgp-preferred-key-error
+           error/incompat-dsa-key-with-tls-protocol
+           error/pkcs11-error
+           error/pkcs11-load-error
+           error/parsing-error
+           error/pkcs11-pin-error
+           error/pkcs11-slot-error
+           error/locking-error
+           error/pkcs11-attribute-error
+           error/pkcs11-device-error
+           error/pkcs11-data-error
+           error/pkcs11-unsupported-feature-error
+           error/pkcs11-key-error
+           error/pkcs11-pin-expired
+           error/pkcs11-pin-locked
+           error/pkcs11-session-error
+           error/pkcs11-signature-error
+           error/pkcs11-token-error
+           error/pkcs11-user-error
+           error/crypto-init-failed
+           error/timedout
+           error/user-error
+           error/ecc-no-supported-curves
+           error/ecc-unsupported-curve
+           error/pkcs11-requested-object-not-availble
+           error/certificate-list-unsorted
+           error/illegal-parameter
+           error/no-priorities-were-set
            error/unimplemented-feature
+           error/application-error-max
+           error/application-error-min
 
            ;; OpenPGP keys (formerly in GnuTLS-extra)
            openpgp-certificate? openpgp-private-key?
diff --git a/guile/modules/gnutls/build/enums.scm b/guile/modules/gnutls/build/enums.scm
index 4cc3cbe..1d7915d 100644
--- a/guile/modules/gnutls/build/enums.scm
+++ b/guile/modules/gnutls/build/enums.scm
@@ -458,10 +458,10 @@ unrecognized-name unknown-psk-identity)
 (define %error-enum
   (make-enum-type 'error "int"
                   '(
+;; FIXME: Automate this:
+;; grep '^#define GNUTLS_E_' ../../../../includes/gnutls/gnutls.h.in \
+;;  | sed -r -e 's/^#define GNUTLS_E_([^ ]+).*$/\1/' | tr A-Z_ a-z-
 success
-unknown-compression-algorithm
-unknown-cipher-type
-large-packet
 unsupported-version-packet
 unexpected-packet-length
 invalid-session
@@ -470,9 +470,6 @@ unexpected-packet
 warning-alert-received
 error-in-finished-packet
 unexpected-handshake-packet
-unknown-cipher-suite
-unwanted-algorithm
-mpi-scan-failed
 decryption-failed
 memory-error
 decompression-failed
@@ -485,10 +482,8 @@ insufficient-credentials
 insuficient-credentials
 insufficient-cred
 insuficient-cred
-invalid-request
 hash-failed
 base64-decoding-error
-mpi-print-failed
 rehandshake
 got-application-data
 record-limit-reached
@@ -513,6 +508,7 @@ dh-prime-unacceptable
 file-error
 too-many-empty-packets
 unknown-pk-algorithm
+too-many-handshake-packets
 no-temporary-rsa-params
 no-compression-algorithms
 no-cipher-suites
@@ -540,7 +536,6 @@ unsupported-certificate-type
 x509-unknown-san
 openpgp-fingerprint-unsupported
 x509-unsupported-attribute
-unknown-algorithm
 unknown-hash-algorithm
 unknown-pkcs-content-type
 unknown-pkcs-bag-type
@@ -550,6 +545,12 @@ constraint-error
 warning-ia-iphf-received
 warning-ia-fphf-received
 ia-verify-failed
+unknown-algorithm
+unsupported-signature-algorithm
+safe-renegotiation-failed
+unsafe-renegotiation-denied
+unknown-srp-username
+premature-termination
 base64-encoding-error
 incompatible-gcrypt-library
 incompatible-crypto-library
@@ -557,7 +558,46 @@ incompatible-libtasn1-library
 openpgp-keyring-error
 x509-unsupported-oid
 random-failed
-unimplemented-feature)
+base64-unexpected-header-error
+openpgp-subkey-error
+crypto-already-registered
+handshake-too-large
+cryptodev-ioctl-error
+cryptodev-device-error
+channel-binding-not-available
+bad-cookie
+openpgp-preferred-key-error
+incompat-dsa-key-with-tls-protocol
+pkcs11-error
+pkcs11-load-error
+parsing-error
+pkcs11-pin-error
+pkcs11-slot-error
+locking-error
+pkcs11-attribute-error
+pkcs11-device-error
+pkcs11-data-error
+pkcs11-unsupported-feature-error
+pkcs11-key-error
+pkcs11-pin-expired
+pkcs11-pin-locked
+pkcs11-session-error
+pkcs11-signature-error
+pkcs11-token-error
+pkcs11-user-error
+crypto-init-failed
+timedout
+user-error
+ecc-no-supported-curves
+ecc-unsupported-curve
+pkcs11-requested-object-not-availble
+certificate-list-unsorted
+illegal-parameter
+no-priorities-were-set
+unimplemented-feature
+application-error-max
+application-error-min
+)
                   "gnutls_strerror"
                   "GNUTLS_E_"))
 
-- 
1.7.2.5


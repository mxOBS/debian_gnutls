From 93354fe965b79203c412c85c312c2fcf096264a7 Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@gnutls.org>
Date: Sat, 25 Feb 2012 12:55:35 +0100
Subject: [PATCH 1/2] make sure that the microseconds field does not overflow

---
 lib/system.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/lib/system.c b/lib/system.c
index 1573bb3..679bb0a 100644
--- a/lib/system.c
+++ b/lib/system.c
@@ -130,6 +130,12 @@ int fd = GNUTLS_POINTER_TO_INT(ptr);
   tv.tv_sec = 0;
   tv.tv_usec = ms * 1000;
   
+  while(tv.tv_usec >= 1000000)
+    {
+      tv.tv_usec -= 1000000;
+      tv.tv_sec++;
+    }
+  
   ret = select(fd+1, &rfds, NULL, NULL, &tv);
   if (ret <= 0)
     return ret;
-- 
1.7.2.5

